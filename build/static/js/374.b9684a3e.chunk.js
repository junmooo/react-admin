"use strict";(self.webpackChunkreact_admin=self.webpackChunkreact_admin||[]).push([[374],{7374:function(e,n,t){t.r(n),t.d(n,{default:function(){return N}});var r=t(3433),a=t(1413),i=t(9439),l=t(2791),o=t(7615),s=t(7027),u=t(7309),d=t(6725),c=t(5795),m=t(43),p=t(5157),f=t(6726),h=t(8406),x=t(2426),Z=t.n(x),y=t(184),g=[{required:!0,message:"\u8be5\u9879\u4e3a\u5fc5\u586b\u9879"}],k=[{title:"\u4e13\u8f91\u540d\u79f0",dataIndex:"albumName",key:"albumName"},{title:"\u6807\u9898",dataIndex:"albumTitle",key:"albumTitle"},{title:"\u526f\u6807\u9898",dataIndex:"albumSubTitle",key:"albumSubTitle"},{title:"\u4e13\u8f91\u63cf\u8ff0",dataIndex:"albumDesc",key:"albumDesc",ellipsis:!0},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"timeCreated",key:"timeCreated",render:function(e,n,t){return Z()(e).format("yy-MM-DD hh:mm")}}],b=[{label:"\u5173\u952e\u8bcd\uff1a\uff08\u6807\u9898\u3001\u526f\u6807\u9898\u3001\u63cf\u8ff0\u3001\u5907\u6ce8\uff09",name:"keyword",key:"keyword"},{label:"\u521b\u5efa\u65f6\u95f4\uff1a",name:"date",valueType:"dateRange",key:"date"}],j=[{title:"\u4e13\u8f91\u540d\u79f0",name:"albumName",key:"albumName",rules:g},{title:"\u6807\u9898",name:"albumTitle",key:"albumTitle",rules:g},{title:"\u526f\u6807\u9898",name:"albumSubTitle",key:"albumSubTitle"},{title:"\u4e13\u8f91\u63cf\u8ff0",name:"albumDesc",valueType:"textArea",key:"albumDesc"}],v=[{title:"\u4e0a\u4f20\u65f6\u95f4",dataIndex:"timeCreated",key:"timeCreated",render:function(e){return Z()(e).format("yy-MM-DD hh:mm")}},{title:"\u663e\u793a/\u9690\u85cf",dataIndex:"hideFlag",key:"hideFlag",render:function(e){return"01"===e?(0,y.jsx)(f.Z,{status:"success",text:"\u663e\u793a"}):(0,y.jsx)(f.Z,{status:"error",text:"\u9690\u85cf"})}},{title:"\u9884\u89c8",dataIndex:"url",key:"url",render:function(e){var n=e.lastIndexOf("."),t=e.substring(0,n)+"-pre"+e.substring(n);return(0,y.jsx)(h.Z,{src:t,preview:!1})}}],w=t(7379),P=t(9428),S=t(6952),C=function(e){var n=e.columns,t=e.show,a=e.setShow,i=e.title,l=e.footer,s=e.form,u=e.loading,d=void 0!==u&&u;return(0,y.jsx)(P.Z,{open:t,width:"80vw",onCancel:function(){a(!1)},footer:(0,y.jsx)(y.Fragment,{}),title:(0,y.jsx)("div",{style:{textAlign:"center",fontSize:"20px"},children:i}),children:(0,y.jsx)(m.Z,{spinning:d,children:n.length>0&&(0,y.jsxs)(o.Z,{form:s,layout:"vertical",labelCol:{span:24},wrapperCol:{span:24},style:{width:"calc(80vw - 100px)",padding:"50px 0 50px 100px",maxHeight:"70vh"},children:[n.map((function(e){return(0,y.jsx)(o.Z.Item,{label:e.title,name:e.name,rules:e.rules,children:(0,S.r)(e)},e.key||e.name)})),(0,y.jsx)(o.Z.Item,{wrapperCol:{span:24},children:l&&(0,r.Z)(l)},"footer")]})})})},F=t(6106),I=t(914),T=t(1730),O=t(9286);var L=function(e){var n=e.runQueryByPage,t=e.setModalProps,r=e.modalProps,d=e.modalForm,c=e.show,m=e.setShow,f=e.setLoading,h=o.Z.useForm(),x=(0,i.Z)(h,1)[0];(0,l.useEffect)((function(){c||n({pgNum:1,pgSize:10})}),[n,c]);var g=(0,w.Z)(p.L.addAlbum,{onSuccess:function(){s.ZP.info("\u65b0\u589e\u6210\u529f"),m(!1),f(!1)},onError:function(e){e.message&&s.ZP.error(e.message)},manual:!0}).run;return(0,y.jsx)(y.Fragment,{children:(0,y.jsxs)(o.Z,{form:x,style:{margin:"30px 20px",minWidth:"750px"},initialValues:{remember:!0},onFinish:function(e){n({keyword:e.keyword,start:(null===e||void 0===e?void 0:e.date)&&Z()(e.date[0]).valueOf(),end:(null===e||void 0===e?void 0:e.date)&&Z()(e.date[1]).valueOf(),pgNum:1,pgSize:10})},layout:"vertical",children:[(0,y.jsx)(F.Z,{gutter:24,children:b.map((function(e){return(0,y.jsx)(I.Z,{span:12,children:(0,y.jsx)(o.Z.Item,{label:e.label,name:e.name,style:{},children:(0,S.r)(e)},e.key||e.name)},e.key||e.name)}))}),(0,y.jsx)(F.Z,{children:(0,y.jsxs)(I.Z,{span:24,style:{textAlign:"right"},children:[(0,y.jsxs)(u.ZP,{type:"primary",htmlType:"submit",children:[(0,y.jsx)(T.Z,{}),"\u67e5\u8be2"]}),(0,y.jsx)("span",{style:{marginLeft:"10px"},children:(0,y.jsxs)(u.ZP,{type:"primary",onClick:function(){m(!0),t((0,a.Z)((0,a.Z)({},r),{},{title:"\u65b0\u589e\u4e13\u8f91",columns:j,footer:[(0,y.jsx)(u.ZP,{type:"primary",htmlType:"submit",block:!0,onClick:function(){d.validateFields().then((function(e){f(!0),g(e)}))},children:"\u521b\u5efa"},"create")]}))},children:[(0,y.jsx)(O.Z,{}),"\u65b0\u589e"]})})]})})]})})},D=t(763),N=function(){var e=(0,l.useState)([]),n=(0,i.Z)(e,2),t=n[0],f=n[1],h=(0,l.useState)(!1),x=(0,i.Z)(h,2),Z=x[0],g=x[1],b=(0,l.useState)(!1),P=(0,i.Z)(b,2),S=P[0],F=P[1],I=o.Z.useForm(),T=(0,i.Z)(I,1)[0],O=(0,l.useState)({columns:[],title:"",show:Z,setShow:g,footer:[(0,y.jsx)(y.Fragment,{})]}),N=(0,i.Z)(O,2),E=N[0],M=N[1],z=(0,w.Z)(p.L.addPhoto,{manual:!0,onSuccess:function(){s.ZP.success("\u64cd\u4f5c\u6210\u529f")}}),A=z.loading,B=z.run,R=(0,w.Z)(p.L.updateAlbum,{onSuccess:function(){s.ZP.success("\u4fee\u6539\u6210\u529f"),g(!1)},onError:function(e){e.message&&s.ZP.error(e.message)},manual:!0}),V=R.loading,q=R.run,K=(0,w.Z)(p.L.updatePhoto,{onSuccess:function(){s.ZP.success("\u4fee\u6539\u6210\u529f"),g(!1),X({pgNum:1,pgSize:10})},onError:function(e){e.message&&s.ZP.error(e.message)},manual:!0}),Q=K.loading,U=K.run,_=(0,w.Z)(p.L.deleteById,{onSuccess:function(){s.ZP.success("\u4fee\u6539\u6210\u529f"),X({pgNum:1,pgSize:10})},onError:function(e){e.message&&s.ZP.error(e.message)},manual:!0}),H=_.loading,W=_.run,G=(0,w.Z)(p.L.queryByPage,{onSuccess:function(e){var n=e.data.records.map((function(e){return(0,a.Z)((0,a.Z)({},e.album),{},{photos:e.photos})}));f(n)},onError:function(e){e.message&&s.ZP.error(e.message)},manual:!0}),J=G.loading,X=G.run,Y=(0,l.useCallback)((0,D.debounce)((function(e){q(e)}),1e3),[]),$=(0,l.useCallback)((0,D.debounce)((function(e){U(e)}),1e3),[]),ee=[].concat((0,r.Z)(k),[{title:"\u6392\u5e8f",dataIndex:"sortOrder",key:"sortOrder",width:"120px",render:function(e,n){return(0,y.jsx)(d.Z,{bordered:!1,min:0,defaultValue:e,onChange:function(e){return Y((0,a.Z)((0,a.Z)({},n),{},{sortOrder:e}))}})}},{title:"\u64cd\u4f5c",key:"action",align:"center",fixed:"right",width:"250px",render:function(e,n){return(0,y.jsxs)(y.Fragment,{children:["01"===n.hideFlag?(0,y.jsx)(u.ZP,{type:"link",style:{color:"red"},onClick:function(){q({id:n.id,hideFlag:"00"})},children:"\u9690\u85cf"}):(0,y.jsx)(u.ZP,{type:"link",style:{color:"green"},onClick:function(){q({id:n.id,hideFlag:"01"})},children:"\u6fc0\u6d3b"}),(0,y.jsx)(u.ZP,{type:"link",onClick:function(){g(!0),T.setFieldsValue(n),M((0,a.Z)((0,a.Z)({},E),{},{title:"\u4fee\u6539\u4e13\u8f91",columns:j,footer:[(0,y.jsx)(u.ZP,{type:"primary",htmlType:"submit",block:!0,onClick:function(){T.validateFields().then((function(e){q((0,a.Z)((0,a.Z)({},e),{},{id:n.id}))}))},children:"\u4fee\u6539"},"create")]}))},children:"\u4fee\u6539"}),(0,y.jsx)(u.ZP,{type:"link",onClick:function(){g(!0),M((0,a.Z)((0,a.Z)({},E),{},{title:"\u6dfb\u52a0\u7167\u7247",columns:[{title:"",name:"url",key:"url",valueType:"imgUpload",fileList:n.photos.map((function(e){var n,t;return{uid:e.id,name:e.name,url:(null===e||void 0===e||null===(n=e.url)||void 0===n?void 0:n.substring(0,e.url.lastIndexOf(".")))+"-pre"+(null===e||void 0===e||null===(t=e.url)||void 0===t?void 0:t.substring(e.url.lastIndexOf("."))),status:"done"}})),onRemove:function(e){W(e)},onUpload:function(e){var t=new FormData;t.append("file",e),t.append("album",n.id),t.append("sortOrder","0"),B(t)}}],footer:[]}))},children:"\u6dfb\u52a0\u7167\u7247"})]})}}]),ne=[].concat((0,r.Z)(v),[{title:"\u6392\u5e8f",dataIndex:"sortOrder",key:"sortOrder-photo",width:"120px",render:function(e,n){return(0,y.jsx)(d.Z,{bordered:!1,min:0,defaultValue:e,onChange:function(e){return $((0,a.Z)((0,a.Z)({},n),{},{sortOrder:e}))}})}},{title:"\u64cd\u4f5c",dataIndex:"operation",key:"operation-photo",render:function(e,n){var t="01"===n.hideFlag;return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(u.ZP,{type:"link",style:{color:"".concat(t?"red":"green")},onClick:function(){U((0,a.Z)((0,a.Z)({},n),{},{hideFlag:"".concat(t?"00":"01")}))},children:t?"\u9690\u85cf":"\u6fc0\u6d3b"}),(0,y.jsx)(u.ZP,{type:"link",style:{color:"red"},onClick:function(){W({id:n.id,fileName:n.name})},children:"\u5220\u9664"})]})}}]);return(0,y.jsx)(m.Z,{spinning:V||A||Q||H,children:(0,y.jsxs)("div",{children:[(0,y.jsx)(L,{runQueryByPage:X,setModalProps:M,modalProps:E,modalForm:T,show:Z,loading:S,setShow:g,setLoading:F}),(0,y.jsx)(c.Z,{loading:J,columns:ee,expandable:{expandedRowRender:function(e){return(0,y.jsx)(c.Z,{columns:ne,dataSource:e.photos,pagination:!1,rowKey:"id"})}},rowKey:"id",dataSource:t,sticky:!0,scroll:{x:1e3}}),(0,y.jsx)(C,(0,a.Z)((0,a.Z)({},E),{},{form:T,show:Z,loading:S}))]})})}}}]);
//# sourceMappingURL=374.b9684a3e.chunk.js.map